name: 'Is this a release?'
description: "This action checks to see if the .version key in a repository's package.json has changed in order to determine if this commit is a release commit"

inputs:
  commit-starts-with:
    description: "Validate that the release commit starts with this string. Use '[version]' to refer to the current release version."
    required: false
  commit-body-starts-with:
    description: "Validate that the release commit body starts with this string. Use '[version]' to refer to the current release version."
    required: false
  package-dir:
    description: "Directory containing the package.json file with the relevant version. For example, a monorepo workspace directory."
    required: false
    default: "."

outputs:
  IS_RELEASE:
    description: 'Is this a release? can be either "true" or "false".'
    value: ${{ steps.is-release.outputs.IS_RELEASE }}

runs:
  using: 'composite'
  steps:
    - uses: actions/checkout@v3
      with:
        ref: ${{ github.sha }}
        # we need this commit + the last so we can compare below
        fetch-depth: 2
    - id: is-release
      shell: bash
      run: ${{ github.action_path }}/scripts/is-release.sh "${{ github.event.before }}" "${{ inputs.commit-starts-with }}" "${{ inputs.commit-body-starts-with }}" "${{ inputs.package-dir }}"
